# Sistema de AnÃ¡lisis Jurisprudencial SCJN

## InstalaciÃ³n

1. **Clonar el repositorio:**
```bash
git clone <repository-url>
cd scjn_analyzer
```

2. **Instalar dependencias:**
```bash
pip install -r requirements.txt
```

3. **Configurar API Key de Gemini:**
```bash
export GEMINI_API_KEY="tu_api_key_aqui"
```

## Uso - VersiÃ³n Consola

### Comando bÃ¡sico
```bash
python main.py --expediente "C:\ruta\a\carpeta\expediente"
```

### Opciones avanzadas
```bash
# Con timeout personalizado (180 segundos)
python main.py --expediente "C:\expediente_123" --timeout 180

# Con mÃ¡s reintentos (3 intentos)
python main.py --expediente "C:\expediente_123" --reintentos 3

# Combinado
python main.py --expediente "C:\expediente_123" --timeout 180 --reintentos 3
```

## Estructura de Archivos

### Antes del procesamiento
```
expediente_123/
â”œâ”€â”€ documento1.pdf
â”œâ”€â”€ documento2.docx
â”œâ”€â”€ documento3.txt
â””â”€â”€ imagen_escaneada.jpg
```

### DespuÃ©s del procesamiento
```
expediente_123/
â”œâ”€â”€ documento1.pdf
â”œâ”€â”€ documento2.docx
â”œâ”€â”€ documento3.txt
â”œâ”€â”€ imagen_escaneada.jpg
â”œâ”€â”€ jsons/
â”‚   â”œâ”€â”€ documento1_mapeado.json
â”‚   â”œâ”€â”€ documento2_mapeado.json
â”‚   â”œâ”€â”€ documento3_mapeado.json
â”‚   â”œâ”€â”€ imagen_escaneada_mapeado.json
â”‚   â””â”€â”€ bitacora_proceso.json
â””â”€â”€ reporte/
    â””â”€â”€ reporte_ejecutivo_expediente_123_20241203_143022.md
```

## Formatos Soportados

### Documentos de texto
- **PDF**: `.pdf` - Procesado con OCR automÃ¡tico
- **Word**: `.docx`, `.doc` - ExtracciÃ³n de texto y tablas
- **Texto plano**: `.txt` - Con detecciÃ³n automÃ¡tica de encoding

### ImÃ¡genes (OCR)
- **JPEG**: `.jpg`, `.jpeg`
- **PNG**: `.png`
- **TIFF**: `.tiff`, `.tif`

## CaracterÃ­sticas del Sistema

### âœ… Resume AutomÃ¡tico
- Si el proceso se interrumpe, puedes ejecutar el mismo comando
- Solo procesarÃ¡ los documentos que faltan
- Mantiene historial completo en bitÃ¡cora

### âœ… Tolerancia a Errores
- ContinÃºa procesando aunque algunos documentos fallen
- Reintentos automÃ¡ticos configurables
- BitÃ¡cora detallada de Ã©xitos y errores

### âœ… Reporte Condicionado
- El reporte ejecutivo **solo se genera cuando TODOS los documentos del expediente estÃ¡n procesados**
- Si faltan documentos, te indica cuÃ¡les y puedes ejecutar de nuevo

### âœ… Progress Visual
```
Procesando documento_largo.pdf...    
ğŸ“„ Documentos: 3/8 [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ----] 75% | exitosos: 3, fallos: 0, tokens: 15,847
```

## Ejemplos de Uso

### Caso 1: Expediente nuevo
```bash
$ python main.py --expediente "C:\expedientes\ADR_6035_2023"

ğŸš€ Analizando expediente: ADR_6035_2023
ğŸ“ Ruta: C:\expedientes\ADR_6035_2023
================================================================================
ğŸ“‹ Expediente nuevo - 5 documentos encontrados

ğŸ”„ Procesando 5 documentos pendientes...
Procesando ADMISION.pdf...              [1/5] âœ… Completado. Tokens: 2,341, Tiempo: 45.23s
Procesando DEMANDA.docx...               [2/5] âœ… Completado. Tokens: 3,892, Tiempo: 67.12s
Procesando SENTENCIA.pdf...              [3/5] âœ… Completado. Tokens: 8,234, Tiempo: 123.45s
Procesando RECURSO.pdf...                [4/5] âœ… Completado. Tokens: 4,567, Tiempo: 78.90s
Procesando ENGROSE.pdf...                [5/5] âœ… Completado. Tokens: 6,123, Tiempo: 89.34s

ğŸ“Š Generando reporte ejecutivo para expediente ADR_6035_2023...
  âœ… Reporte generado: reporte_ejecutivo_ADR_6035_2023_20241203_143022.md
  ğŸ“Š Tokens utilizados: 2,456
  ğŸ“„ Documentos analizados: 5

================================================================================
ğŸ‰ EXPEDIENTE COMPLETADO
================================================================================
ğŸ“„ Documentos procesados exitosamente: 5
âŒ Documentos con errores: 0
ğŸ”¤ Total de tokens utilizados: 27,613
â±ï¸ Tiempo total de procesamiento: 406.50 segundos
ğŸ’° Costo estimado (aprox): $0.0276 USD
ğŸ“Š Reporte ejecutivo generado
================================================================================
```

### Caso 2: Resume de expediente interrumpido
```bash
$ python main.py --expediente "C:\expedientes\ADR_6035_2023"

ğŸš€ Analizando expediente: ADR_6035_2023
ğŸ“ Ruta: C:\expedientes\ADR_6035_2023
================================================================================
ğŸ“‹ Resumiendo expediente - 3 procesados, 2 pendientes

ğŸ”„ Procesando 2 documentos pendientes...
Procesando RECURSO.pdf...                [1/2] âœ… Completado. Tokens: 4,567, Tiempo: 78.90s
Procesando ENGROSE.pdf...                [2/2] âœ… Completado. Tokens: 6,123, Tiempo: 89.34s

ğŸ“Š Generando reporte ejecutivo para expediente ADR_6035_2023...
...
```

### Caso 3: Expediente con errores
```bash
ğŸ”„ Procesando 3 documentos pendientes...
Procesando documento_corrupto.pdf...     [1/3] ğŸ”„ Intento 1 fallÃ³: Invalid PDF... Reintentando en 5s
                                               ğŸ”„ Intento 2 fallÃ³: Invalid PDF... Reintentando en 5s
                                               âŒ Error final despuÃ©s de 3 intentos
Procesando documento_ok.docx...           [2/3] âœ… Completado. Tokens: 2,341, Tiempo: 45.23s
Procesando otro_ok.pdf...                [3/3] âœ… Completado. Tokens: 3,456, Tiempo: 67.89s

â³ Expediente incompleto. Documentos faltantes: 1
   ğŸ“„ documento_corrupto.pdf
ğŸ’¡ Ejecuta el comando nuevamente para procesar los documentos faltantes
```

## Variables de Entorno

```bash
# Requerida
export GEMINI_API_KEY="tu_api_key_de_gemini"

# Opcionales (con valores por defecto)
export TIMEOUT_BASE_SEGUNDOS=120
export MAX_REINTENTOS=2
export PAUSA_ENTRE_DOCUMENTOS=2.0
```

## Troubleshooting

### Error: API Key no configurada
```bash
âŒ Error: GEMINI_API_KEY no estÃ¡ configurada en las variables de entorno
```
**SoluciÃ³n:** Configura la variable de entorno con tu API key de Gemini.

### Error: Timeout en documentos grandes
```bash
ğŸ”„ Intento 1 fallÃ³: Request timeout... Reintentando en 5s
```
**SoluciÃ³n:** Usa un timeout mayor:
```bash
python main.py --expediente "C:\expediente" --timeout 300
```

### Error: Carpeta no existe
```bash
âŒ Error: La carpeta C:\expediente_inexistente no existe
```
**SoluciÃ³n:** Verifica la ruta del expediente.

## Estructura de la BitÃ¡cora

```json
{
  "resumen_expediente": {
    "numero_expediente": "ADR_6035_2023",
    "total_documentos_disponibles": 5,
    "total_documentos_procesados": 5,
    "total_documentos_fallidos": 0,
    "tokens_totales": 27613,
    "tiempo_total_procesamiento": 406.5,
    "expediente_completo": true
  },
  "bitacora_detallada": [
    {
      "timestamp": "2024-12-03T14:25:15",
      "expediente": "ADR_6035_2023",
      "documento": "ADMISION.pdf",
      "status": "success",
      "mensaje": "Procesado exitosamente en intento 1. Tokens: 2341",
      "metadata": {
        "nombre_archivo": "ADMISION.pdf",
        "formato": ".pdf",
        "tamano_bytes": 156789,
        "tokens_utilizados": 2341,
        "tiempo_procesamiento": 45.23,
        "hash_archivo": "abc123..."
      }
    }
  ]
}
```